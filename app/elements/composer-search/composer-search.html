<!-- <link rel="import" href="../../bower_components/polymer/polymer.html"> -->
<link rel="import" href="../../bower_components/core-icons/core-icons.html">
<link rel="import" href="../../bower_components/core-icon/core-icon.html">
<link rel="import" href="../../bower_components/core-field/core-field.html">
<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">

<!-- 
  TODO:
    use core-field or paper-input
    autocomplete
    stuff search results into localstorage
    byot (bring your own template)
 -->

<polymer-element name="composer-search" attributes="url, per_page, autofocus, placeholder, results">

  <template>
    <link rel="stylesheet" href="composer-search.css">

    <form action="{{url}}" 
          autocomplete="off" 
          on-submit="{{onSubmit}}">
      <div class="search-container">
        <core-field>
          <core-icon icon="search"></core-icon>
          <input 
            type="search" 
            autocomplete="off" 
            autofocus?="{{autofocus}}" 
            id="search" 
            name="search" 
            placeholder="{{placeholder}}" 
            value="{{searchString}}">
        </core-field>
        <core-ajax
          id="ajax"
          name="ajax"
          url="{{url}}?q={{searchString}}&per_page={{per_page}}"
          handleAs="json"
          response="{{results}}"></core-ajax>
      </div>
    </form>
  </template>

  <script>
    (function () {
      'use strict';

      Polymer({

        url: 'http://opendata.arcgis.com',
        per_page: 10,
        autofocus: true,
        placeholder: 'Search for Open Data',
        searchString: '',

        onSubmit: function (e) {
          e.preventDefault();
          this.fire('search-before-start', this.results);
          this.$.ajax.go();
          this.fire('search-after-start', this.results);
        },

        resultsChanged: function (oldVal) {
          this.fire('search-completed', this.results);
        }

      });

    })();
  </script>

</polymer-element>
